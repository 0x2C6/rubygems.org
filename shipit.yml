dependencies:
  bundler:
    frozen: false

deploy:
  override:
    - KUBECONFIG=/kubeconfig.yml bundle exec kubernetes-deploy rubygems-$ENVIRONMENT rubygems --template-dir config/deploy/$ENVIRONMENT --bindings=environment=$ENVIRONMENT

rollback:
  override:
    - KUBECONFIG=/kubeconfig.yml bundle exec kubernetes-deploy rubygems-$ENVIRONMENT rubygems --template-dir config/deploy/$ENVIRONMENT --bindings=environment=$ENVIRONMENT

tasks:
  restart:
    action: Restart application
    description: Trigger the restart of both unicorn and background workers
    steps:
      - KUBECONFIG=/kubeconfig.yml bundle exec kubernetes-restart rubygems-$ENVIRONMENT rubygems
